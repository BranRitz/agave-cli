#!/bin/bash

source ../conf/settings.sh

ACTION=$1

if [ -z $ACTION ]; then
	curl -sku "$API_USERNAME:$API_PASSWORD" $API_BASE_URL/apps-v1/apps/list/ \
	| python -mjson.tool \
	| grep '^            "id"' \
	| perl -pe "s/\"id\"://; s/\"//g; s/,//; s/\s//g; print \"\n\";";
elif [ $ACTION == 'list' ]; then
	APP=$2
	if [ -z $APP ]; then
		curl -sku "$API_USERNAME:$API_PASSWORD" $API_BASE_URL/apps-v1/apps/list/ \
		| python -mjson.tool \
		| grep '^            "id"' \
		| perl -pe "s/\"id\"://; s/\"//g; s/,/\n/; s/\s//g; print \"\n\";";
	else
		curl -sku "$API_USERNAME:$API_PASSWORD" $API_BASE_URL/apps-v1/apps/$APP | \
		python -mjson.tool
	fi
elif [ $ACTION == 'search' ]; then
	TYPE=$2
	TERM=$3
	if [ $TYPE == 'name' ]; then
		curl -sku "$API_USERNAME:$API_PASSWORD" $API_BASE_URL/apps-v1/apps/name/$TERM | \
		python -mjson.tool | \
		grep '^            "id"' | \
		perl -pe "s/\"id\"://; s/\"//g; s/,/\n/; s/\s//g; print \"\n\";";
	elif [ $TYPE == 'term' ]; then
		curl -sku "$API_USERNAME:$API_PASSWORD" $API_BASE_URL/apps-v1/apps/isa/$TERM | \
		python -mjson.tool | \
		grep '^            "id"' | \
		perl -pe "s/\"id\"://; s/\"//g; s/,/\n/; s/\s//g; print \"\n\";";
	elif [ $TYPE == 'tag' ]; then
		curl -sku "$API_USERNAME:$API_PASSWORD" $API_BASE_URL/apps-v1/apps/tag/$TERM | \
		python -mjson.tool | \
		grep '^            "id"' | \
		perl -pe "s/\"id\"://; s/\"//g; s/,/\n/; s/\s//g; print \"\n\";";
	else
		echo "Invalid search type. Valid types are: name, tag, and term";
		exit 1;
	fi
fi

echo '';